<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="这篇博客,整理了一些我在学习LLVM或者写相关的代码时所学习过的基础知识, 很多部分参考了LLVM的官方文档等. 1. LLVM相关工具链 1) 工具链简要介绍   image-20230106160440645  总体来说, 在编译阶段, LLVM中会涉及到以下这些数据结构的形式: (1)将源代码转换为IR之前会处理成AST, 即TranslationUnitDecl.(2) IR转化为目标语言">
<meta property="og:type" content="article">
<meta property="og:title" content="LLVM学习记录">
<meta property="og:url" content="http://example.com/2023/010612922.html">
<meta property="og:site_name" content="Yfs&#39;s Box">
<meta property="og:description" content="这篇博客,整理了一些我在学习LLVM或者写相关的代码时所学习过的基础知识, 很多部分参考了LLVM的官方文档等. 1. LLVM相关工具链 1) 工具链简要介绍   image-20230106160440645  总体来说, 在编译阶段, LLVM中会涉及到以下这些数据结构的形式: (1)将源代码转换为IR之前会处理成AST, 即TranslationUnitDecl.(2) IR转化为目标语言">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2006%2016%2004%2040%201672992280%201672992280777%20DXfUPt%20image-20230106160440645%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2006%2016%2023%2002%201672993382%201672993382192%20nnQbsl%20image-20230106162302084%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2009%2056%2004%201672538164%201672538164889%208nle18%20image-20230101095604804%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2009%2057%2037%201672538257%201672538257282%20HdrFbJ%20image-20230101095737188%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2001%2031%201672538491%201672538491005%20Kb2ZA1%20image-20230101100130916%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2005%2015%201672538715%201672538715808%202XUcw2%20image-20230101100515723%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2018%2022%201672539502%201672539502327%20Usm7Ry%20image-20230101101822231%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2019%2050%201672539590%201672539590257%20uPFZrp%20image-20230101101950170%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2038%2033%201672540713%201672540713020%20u6CoQp%20image-20230101103832921%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2049%2045%201672541385%201672541385665%20nDGylX%20image-20230101104945570%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2011%2009%2032%201672542572%201672542572984%20FMvRdt%20image-20230101110932887%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2022%2012%2031%2023%2038%2027%201672501107%201672501107596%20A6FNOX%20image-20221231233827507%20.png">
<meta property="og:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2022%2012%2031%2023%2010%2034%201672499434%201672499434054%20Lyaqq1%20image-20221231231033949%20.png">
<meta property="article:published_time" content="2023-01-06T04:39:28.000Z">
<meta property="article:modified_time" content="2023-01-06T10:03:19.368Z">
<meta property="article:author" content="yfs">
<meta property="article:tag" content="LLVM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2006%2016%2004%2040%201672992280%201672992280777%20DXfUPt%20image-20230106160440645%20.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>LLVM学习记录</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<link rel="stylesheet" href="/js/prism/prism.css">

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2023/011947300.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2022/12294483.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/010612922.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/010612922.html&text=LLVM学习记录"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/010612922.html&is_video=false&description=LLVM学习记录"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=LLVM学习记录&body=Check out this article: http://example.com/2023/010612922.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/010612922.html&name=LLVM学习记录&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/010612922.html&t=LLVM学习记录"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#llvm%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E9%93%BE"><span class="toc-number">1.</span> <span class="toc-text">1. LLVM相关工具链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E9%93%BE%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1) 工具链简要介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#llvm-ir"><span class="toc-number">2.</span> <span class="toc-text">2. LLVM IR</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#type-system-and-geps"><span class="toc-number">2.1.</span> <span class="toc-text">Type System And Geps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">2.2.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#llvm-programmers-manual"><span class="toc-number">3.</span> <span class="toc-text">3. LLVM Programmer’s Manual</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#helpful-hints-for-common-operations"><span class="toc-number">3.1.</span> <span class="toc-text">1) Helpful Hints for Common
Operations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-core-llvm-class-hierarchy-reference"><span class="toc-number">3.2.</span> <span class="toc-text">2) The Core LLVM Class
Hierarchy Reference</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-llvm-target-independent-code-generator"><span class="toc-number">4.</span> <span class="toc-text">4. The LLVM
Target-Independent Code Generator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#target-description-classes"><span class="toc-number">4.1.</span> <span class="toc-text">1) Target description classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#machine-code-description-classes"><span class="toc-number">4.2.</span> <span class="toc-text">2) Machine code description
classes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#llvm%E5%90%8E%E7%AB%AF"><span class="toc-number">5.</span> <span class="toc-text">5. LLVM后端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">5.1.</span> <span class="toc-text">1) 总体架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E5%88%86%E9%85%8D"><span class="toc-number">5.2.</span> <span class="toc-text">2) 寄存器分配</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        LLVM学习记录
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">yfs</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-01-06T04:39:28.000Z" itemprop="datePublished">2023-01-06</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/LLVM/" rel="tag">LLVM</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>这篇博客,整理了一些我在学习LLVM或者写相关的代码时所学习过的基础知识,
很多部分参考了LLVM的官方文档等.</p>
<h2 id="llvm相关工具链">1. LLVM相关工具链</h2>
<h3 id="工具链简要介绍">1) 工具链简要介绍</h3>
<figure>
<img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2006%2016%2004%2040%201672992280%201672992280777%20DXfUPt%20image-20230106160440645%20.png" alt="image-20230106160440645">
<figcaption aria-hidden="true">image-20230106160440645</figcaption>
</figure>
<p><strong>总体来说, 在编译阶段, LLVM中会涉及到以下这些数据结构的形式:
(1)将源代码转换为IR之前会处理成AST,
即<code>TranslationUnitDecl</code>.(2) IR转化为目标语言之前,
先生成DAG用于指令选择(SelectionDAG).然后转换为三地址形式(MachineFunction)用于指令选择.(3)
为了实现汇编器和链接器, 使用第四种数据结构(MCModule).</strong></p>
<p>源代码在编译期间会涉及到一些中间数据结构的生成, 比如说AST, IR,
DAG等等, 这些也正是编译的不同阶段的生成物,
<strong>这些数据结构既可以指在运行时保存在内存中,
也可以存储于磁盘(文件)之中</strong>. 对于前者的处理方式,
是通过clang以一个总管程序,
其下管理着编译各阶段的工作模块,编译中间所生成的数据结构可以在内存中在不同的模块之间传递.
如果想要通过文件的方式进行处理,
可以直接使用独立出来模块工具输出于磁盘.</p>
<p>关于上面提到的独立工具, 最重要的是opt和llc,
前者通过llvm中的libLLVMipa, 后者通过libLLVMCodeGen实现.
<strong>我们应当将LLVM理解为一个实现了各种编译器框架的库</strong>,
其他工具都是基于库中的某些子集实现的.</p>
<p>接下来对这些独立的工具进行简要的介绍:</p>
<ul>
<li>opt, 输入是IR,用于对IR进行优化,输出也是IR.</li>
<li>llvm-as, 将可读的IR文件(.ll)转化为llvm bitcode形式(.bc).</li>
<li>llvm-dis, 是前者的逆向工具, 将llvm bitcode(.bc)转化成IR(.ll).</li>
<li>llc, 通过特定后端将LLVM位码转换成目标汇编语言或者目标语言.</li>
<li>llvm-link, bitcode文件的链接器.</li>
</ul>
<p>总体来说, 一个完整的编译过程如下所示:</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2006%2016%2023%2002%201672993382%201672993382192%20nnQbsl%20image-20230106162302084%20.png" alt="image-20230106162302084" style="zoom: 50%;"></p>
<h2 id="llvm-ir">2. LLVM IR</h2>
<p>为什么要设计IR?
正所谓“软件工程中任何问题都可以通过增加一层来解决”.增加了一层IR,
可以使得后续的程序优化都基于IR来完成, 并且设计了IR之后,
当需要涉及新的编程语言时, 不再需要专门为其设计后端部分,
只要遵循一定的IR规范,
只设计好前端部分就可以.这大大增强了模块的可复用性.</p>
<p>IR从形式上来看,
就像是汇编语言的伪代码.其中在llvm中其编译模式如下:</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2009%2056%2004%201672538164%201672538164889%208nle18%20image-20230101095604804%20.png" alt="image-20230101095604804" style="zoom: 33%;"></p>
<p>llvm规范的IR模式下, 其所构建的数据结构如下:</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2009%2057%2037%201672538257%201672538257282%20HdrFbJ%20image-20230101095737188%20.png" alt="image-20230101095737188" style="zoom:33%;"></p>
<p>其中关于Target information主要由两部分组成:</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2001%2031%201672538491%201672538491005%20Kb2ZA1%20image-20230101100130916%20.png" alt="image-20230101100130916" style="zoom:33%;"></p>
<p>下面是一个简单的程序片段及其翻译成IR代码的形式:</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2005%2015%201672538715%201672538715808%202XUcw2%20image-20230101100515723%20.png" alt="image-20230101100515723" style="zoom:33%;"></p>
<p>其中关于寄存器, 有unamed和named之分,
其中即使是像result这样已经命名的“寄存器”
到后面转化成目标代码时也需要进行转化.<strong>在LLVM
IR中假定寄存器在使用上是无限的</strong>.</p>
<p>在IR代码中, Type也是一个重要的概念,
比如说上面的i32.这通常作为指令语句中的操作数.对于生成指令所需要格式,
应当参考<a target="_blank" rel="noopener" href="https://llvm.org/docs/LangRef.html">LLVM Language
Reference</a>完成.</p>
<p>接下来给定一个更加复杂的例子:</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2018%2022%201672539502%201672539502327%20Usm7Ry%20image-20230101101822231%20.png" alt="image-20230101101822231" style="zoom:33%;"></p>
<p>其中关于基本块的概念,
上面代码中可以划分出3个基本块.根据基本块可以得出CFG如下:</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2019%2050%201672539590%201672539590257%20uPFZrp%20image-20230101101950170%20.png" alt="image-20230101101950170" style="zoom:50%;"></p>
<p>接下来是一个迭代累乘的例子:</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2038%2033%201672540713%201672540713020%20u6CoQp%20image-20230101103832921%20.png" alt="image-20230101103832921" style="zoom: 33%;"></p>
<p>在上面的这份代码中, 会出现“multiple definition of local value named
‘temp’”的错误,
因而引出SSA的问题.因此对temp重新命名为<code>new_temp</code>,
其后面的i修改为<code>i_plus_one</code>.在SSA中对于出现分支的情况,
需要用Phi来表示这种不确定的变量.<strong>SSA在LLVM的IR中是贯彻始终的</strong>.</p>
<p>下面是一种采用了SSA的形式:</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2010%2049%2045%201672541385%201672541385665%20nDGylX%20image-20230101104945570%20.png" alt="image-20230101104945570" style="zoom:33%;"></p>
<p>关于全局变量, 其前缀为@.</p>
<h3 id="type-system-and-geps">Type System And Geps</h3>
<p>首先看数组类型:</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">@array = global [17 x   ]
@array = global [17 x i8]
@array = global [17 x i8] zeroinitialzer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>GEP指令指的是Get Element Pointer指令.其中语法表示如下:</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;result&gt; = getelementptr &lt;ty&gt;, &lt;ty&gt;* &lt;ptrval&gt;, [i32 &lt;idx&gt;]+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可以通过某一个base的指针, 根据一定的偏移量获取新的指针.</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2023%2001%2001%2011%2009%2032%201672542572%201672542572984%20FMvRdt%20image-20230101110932887%20.png" alt="image-20230101110932887" style="zoom: 33%;"></p>
<p>关于struct相关的语法, 其形式是一个"type + {}"的形式.比如说:</p>
<pre class="line-numbers language-none"><code class="language-none">%MyStruct = type { i8, i32, [3 x i32]}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="补充">补充</h3>
<p>一个.ll文件所对应的内容对应了内存中抽象成的Module.<strong>该数据结构可以视为一个程序的顶层数据结构</strong>.除了包含了一些函数(内部由基本块和指令构成),还包含了一系列外围对象,
比如全局变量、目标数据布局等等.总之在理解Module的结构和作用时,
应当结合.ll文件的内容去理解.</p>
<p>总体上, 总结LLVM IR语法的核心特点:</p>
<ul>
<li><strong>使用SSA.</strong>这使得我们编写代码访问一个被引用的变量时可以直接获取其唯一的定义(Instruction).进而生成use-def链变得简单,
use-def将会用于常量传播和冗余表达式消除等优化.<strong>SSA的使用避免了再需要通过数据流分析构造use-def链</strong>.</li>
<li><strong>形式上,采用了三地址形式</strong>.就像是汇编语言的伪代码一样.</li>
<li><strong>变量体现为无限数量的虚拟寄存器</strong>.</li>
</ul>
<p>关于目标数据布局(target layout):</p>
<pre class="line-numbers language-none"><code class="language-none">target datalayout = "e-p:64:64:64-i1:8:8-i8:8:8-i16:16:16-i32:32:32-i64:64:64-f32:32:32-f64:64:64-v64:64:64-v128:128:128-a0:0:64-s0:64:64-f80:128:128-n8:16:32:64-S128"
target triple = "x86_64-apple-macosx10.7.0"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这一部分的信息所对应的数据结构是<code>IR/DataLayout</code>等数据结构.</p>
<h2 id="llvm-programmers-manual">3. LLVM Programmer’s Manual</h2>
<p>简要的记录一下阅读Manual时比较重要和基础的东西,
如果这个不好好读一读的话, 些LLVM Pass完全就无从下手.</p>
<p><strong>关于RTTI</strong>.首先是关于<code>isa&lt;&gt;, cast&lt;&gt;, dyn_cast&lt;&gt;</code>等.
isa就像Java中的<code>instanceof</code>返回值时bool类型,用来判断某个对象(指针或者引用)是否是某个特定class类型的.
cast&lt;&gt;用来将基类指针(或者引用)转化成派生类.<code>dyn_cast&lt;&gt;</code>则类似于dynamic_case&lt;&gt;.</p>
<p><strong>关于strings.</strong>主要是StringRef,可以通过.str获取其std::string对象.formatv与格式化字符串有关,
其使用方式类似于printf, 但是关于类型没有严格限制,
也不需要必须标明类型.其中相关的例子如下:</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// Left, right, and center alignment</span>
S <span class="token operator">=</span> <span class="token function">formatv</span><span class="token punctuation">(</span><span class="token string">"{0,7}"</span><span class="token punctuation">,</span>  <span class="token char">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// S == "      a";</span>
S <span class="token operator">=</span> <span class="token function">formatv</span><span class="token punctuation">(</span><span class="token string">"{0,-7}"</span><span class="token punctuation">,</span> <span class="token char">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// S == "a      ";</span>
S <span class="token operator">=</span> <span class="token function">formatv</span><span class="token punctuation">(</span><span class="token string">"{0,=7}"</span><span class="token punctuation">,</span> <span class="token char">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// S == "   a   ";</span>
S <span class="token operator">=</span> <span class="token function">formatv</span><span class="token punctuation">(</span><span class="token string">"{0,+7}"</span><span class="token punctuation">,</span> <span class="token char">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// S == "      a";</span>
<span class="token comment">// Custom styles</span>
S <span class="token operator">=</span> <span class="token function">formatv</span><span class="token punctuation">(</span><span class="token string">"{0:N} - {0:x} - {1:E}"</span><span class="token punctuation">,</span> <span class="token number">12345</span><span class="token punctuation">,</span> <span class="token number">123908342</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// S == "12,345 - 0x3039 - 1.24E8"</span>
<span class="token comment">// Adapters</span>
S <span class="token operator">=</span> <span class="token function">formatv</span><span class="token punctuation">(</span><span class="token string">"{0}"</span><span class="token punctuation">,</span> <span class="token function">fmt_align</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> AlignStyle<span class="token double-colon punctuation">::</span>Center<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// S == "  42   "</span>
S <span class="token operator">=</span> <span class="token function">formatv</span><span class="token punctuation">(</span><span class="token string">"{0}"</span><span class="token punctuation">,</span> <span class="token function">fmt_repeat</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// S == "hihihi"</span>
S <span class="token operator">=</span> <span class="token function">formatv</span><span class="token punctuation">(</span><span class="token string">"{0}"</span><span class="token punctuation">,</span> <span class="token function">fmt_pad</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// S == "  hi      "</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>关于lambda</strong>.<code>function_ref</code>相当于C++标准中的std::function.使用起来几乎也是一模一样.</p>
<p><strong>关于数据结构</strong>.
先写几个感觉容易用到的.ArrayRef是定长数组, 使用起来和数组几乎一样,
<strong>当API参数类型为ArrayRef时, 可以通过std::vector, 普通定长数组,
llvm::SmallVector来传递</strong>.返回值应该也是同样的道理.<code>SmallSet</code>使用起来类似于std::set.关于Map的有StringMap,IndexedMap等等.</p>
<h3 id="helpful-hints-for-common-operations">1) Helpful Hints for Common
Operations</h3>
<p>下面是一些遍历操作:</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 遍历function中的BasicBlock</span>
Function <span class="token operator">&amp;</span>Func <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>BasicBlock <span class="token operator">&amp;</span>BB <span class="token operator">:</span> Func<span class="token punctuation">)</span>
  <span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Basic block (name="</span> <span class="token operator">&lt;&lt;</span> BB<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">") has "</span>
             <span class="token operator">&lt;&lt;</span> BB<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" instructions.\n"</span><span class="token punctuation">;</span>
<span class="token comment">// 遍历BasicBlock中的Instructions</span>
BasicBlock<span class="token operator">&amp;</span> BB <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>Instruction <span class="token operator">&amp;</span>I <span class="token operator">:</span> BB<span class="token punctuation">)</span>
   <span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> I <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
<span class="token comment">// 直接通过Function遍历Instructions</span>
std<span class="token double-colon punctuation">::</span>set<span class="token operator">&lt;</span>Instruction<span class="token operator">*</span><span class="token operator">&gt;</span> worklist<span class="token punctuation">;</span>
<span class="token comment">// or better yet, SmallPtrSet&lt;Instruction*, 64&gt; worklist;</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>inst_iterator I <span class="token operator">=</span> <span class="token function">inst_begin</span><span class="token punctuation">(</span>F<span class="token punctuation">)</span><span class="token punctuation">,</span> E <span class="token operator">=</span> <span class="token function">inst_end</span><span class="token punctuation">(</span>F<span class="token punctuation">)</span><span class="token punctuation">;</span> I <span class="token operator">!=</span> E<span class="token punctuation">;</span> <span class="token operator">++</span>I<span class="token punctuation">)</span>
  worklist<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span>I<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 遍历Blocks中的predecessors或者successors</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/CFG.h"</span></span>
BasicBlock <span class="token operator">*</span>BB <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>BasicBlock <span class="token operator">*</span>Pred <span class="token operator">:</span> <span class="token function">predecessors</span><span class="token punctuation">(</span>BB<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>下面是一些修改相关的操作:</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 创建Instruction</span>
<span class="token keyword keyword-auto">auto</span> <span class="token operator">*</span>ai <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token function">AllocaInst</span><span class="token punctuation">(</span>Type<span class="token double-colon punctuation">::</span>Int32Ty<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-auto">auto</span> <span class="token operator">*</span>pa <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token function">AllocaInst</span><span class="token punctuation">(</span>Type<span class="token double-colon punctuation">::</span>Int32Ty<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"indexLoc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Insert Instruction</span>

<span class="token comment">// Deleting Instructions</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="the-core-llvm-class-hierarchy-reference">2) The Core LLVM Class
Hierarchy Reference</h3>
<p>这一部分主要接收IR在内存中所采用的数据结构表示.</p>
<p>总体的继承体系如(不考虑list node):</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2022%2012%2031%2023%2038%2027%201672501107%201672501107596%20A6FNOX%20image-20221231233827507%20.png" alt="" style="zoom: 33%;"></p>
<p>这一部分涉及到的东西还挺多的.</p>
<p><strong>Type</strong>.在llvm IR中, 其中涉及的变量是有类型之分的.</p>
<p><img src="https://yfspicturebad1-1309550486.cos.ap-nanjing.myqcloud.com/uPic/2022%2012%2031%2023%2010%2034%201672499434%201672499434054%20Lyaqq1%20image-20221231231033949%20.png" alt="" style="zoom: 33%;"></p>
<p><strong>Value</strong>.正如同linux系统中的一切皆文件,
llvm中也有一个重要的概念, 也就是一切皆Value,
后面会提到的Module、User、Instruction等class都是从class中派生出来的.狭义的Value表示指令中有类型的值.每一个Value都有一个type,并且可以通过getType从中获取.其中开放的接口有:Users相关的迭代器、number,
还有getType, hasName,
getName等等.尤其是replaceAllUsesWith可以用来设置其中的Users.</p>
<p><strong>Module,可以看作是对于一个程序的抽象.</strong>其中的数据成员有一系列Function、GlobalVariable、SymbolTable,
并且对于这些对象都提供对外访问的接口.</p>
<p><strong>Instruction,用来描述一条具体的指令.</strong>
其中包含了指令类型、操作数.其中提供的方法有getOpcode用来返回指令类型,
通过User::getOperand或者User::setOperand()用来获取/修改下标的指令的操作数.关于这些Operand,
其类型都是Value的.由于Instruction除了继承User之外还继承了一个表示list
node class的类用于适配与list, 还有getParent用来返回其所处的基本块等.</p>
<p><strong>Constant</strong>,表示的是所有常量的基类.</p>
<p><strong>Function</strong>, 继承自GlobalObject,
表示的是一个全局的独立对象.其中使用Argument
class来表示函数的形参.其中的数据成员有几个BasicBlock,Argument,还有一个SymbolTable.其中的符号表用来对某个变量进行lookup.尤其是在处理函数内部的变量时,
有时需要区分时形参还是局部变量等等.</p>
<p><strong>BasicBlock</strong>, 维护了a list of
Instructions.一定归属于某个Function之中.在访问时,
除了可以获取其中的指令, 还可以结合CFG来进行访问,
比如说通过getSinglePredecessor访问前一个基本块.</p>
<blockquote>
<p><strong>体会Value和User设计的巧妙之处</strong></p>
</blockquote>
<h2 id="the-llvm-target-independent-code-generator">4. The LLVM
Target-Independent Code Generator</h2>
<h3 id="target-description-classes">1) Target description classes</h3>
<p>这一部分主要由一系列的Info构成.</p>
<h3 id="machine-code-description-classes">2) Machine code description
classes</h3>
<h2 id="llvm后端">5. LLVM后端</h2>
<p>其中一些关于指令选择和指令调度的部分, 我没怎么学过,
所以这方面只从宏观的层面写一下.</p>
<h3 id="总体架构">1) 总体架构</h3>
<p>和IR Pass一样, 这一部分也是由一些分析Pass和变换Pass所组成.</p>
<p>这其中涉及到主要阶段如下:</p>
<ul>
<li><strong>指令选择</strong>,
将IR转化成指定目标的<code>SelectionDAG</code>结点,
根据IR生成一个有向无环图(DAG)的形式.当此阶段结束为止, DAG中的所有LLVM
IR结点<strong>都会转化为目标机器结点, 也就是机器指令而非LLVM
IR指令.</strong></li>
<li><strong>指令调度</strong>.DAG更多时候只能表达一种依赖图关系,
无法通过DAG直接得到指令序列, 因此需要结合原本的IR,
在生成对应的目标指令序列.</li>
<li><strong>寄存器分配</strong>, 之前的的寄存器形式都是虚拟寄存器,
这里分配成实际的物理寄存器, 由于目标机器的寄存器集合是有限的,
所以对于某些虚拟变量是需要溢出的.</li>
</ul>
<p>经过以上阶段后, 最终输出目标代码.</p>
<h3 id="寄存器分配">2) 寄存器分配</h3>
<h2 id="参考">参考</h2>
<p><a target="_blank" rel="noopener" href="https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch03.html">Getting
Started with LLVM Core Libraries</a></p>
<p><a target="_blank" rel="noopener" href="https://www.llvm.org/docs/WritingAnLLVMBackend.html#writing-an-llvm-backend">Writing
an LLVM Backend</a></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#llvm%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E9%93%BE"><span class="toc-number">1.</span> <span class="toc-text">1. LLVM相关工具链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E9%93%BE%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1) 工具链简要介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#llvm-ir"><span class="toc-number">2.</span> <span class="toc-text">2. LLVM IR</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#type-system-and-geps"><span class="toc-number">2.1.</span> <span class="toc-text">Type System And Geps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">2.2.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#llvm-programmers-manual"><span class="toc-number">3.</span> <span class="toc-text">3. LLVM Programmer’s Manual</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#helpful-hints-for-common-operations"><span class="toc-number">3.1.</span> <span class="toc-text">1) Helpful Hints for Common
Operations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-core-llvm-class-hierarchy-reference"><span class="toc-number">3.2.</span> <span class="toc-text">2) The Core LLVM Class
Hierarchy Reference</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-llvm-target-independent-code-generator"><span class="toc-number">4.</span> <span class="toc-text">4. The LLVM
Target-Independent Code Generator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#target-description-classes"><span class="toc-number">4.1.</span> <span class="toc-text">1) Target description classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#machine-code-description-classes"><span class="toc-number">4.2.</span> <span class="toc-text">2) Machine code description
classes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#llvm%E5%90%8E%E7%AB%AF"><span class="toc-number">5.</span> <span class="toc-text">5. LLVM后端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">5.1.</span> <span class="toc-text">1) 总体架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E5%88%86%E9%85%8D"><span class="toc-number">5.2.</span> <span class="toc-text">2) 寄存器分配</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/010612922.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/010612922.html&text=LLVM学习记录"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/010612922.html&is_video=false&description=LLVM学习记录"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=LLVM学习记录&body=Check out this article: http://example.com/2023/010612922.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/010612922.html&title=LLVM学习记录"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/010612922.html&name=LLVM学习记录&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/010612922.html&t=LLVM学习记录"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    yfs
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
      --><li><a href="/">首页</a></li><!--
    --><!--
      --><li><a href="/about/">关于</a></li><!--
    --><!--
      --><li><a href="/archives/">归档</a></li><!--
    -->
      </ul>
      <ul>
        
          <!-- 不蒜子统计 -->
          <span id="busuanzi_container_site_pv">
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          <span class="post-meta-divider">|</span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                  本站访客数<span id="busuanzi_value_site_uv"></span>人
          </span>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
  
</footer>

<script src="/js/prism/prism.js" async></script>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'cactus-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'owner/githubrepo';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
